<script setup lang="ts">
import BtnModifier from '@/components/buttons/BtnModifier.vue';
import InputError from '@/components/InputError.vue';
import LinkBtnRetour from '@/components/links/LinkBtnRetour.vue';
import { Button } from '@/components/ui/button';
import { Calendar } from '@/components/ui/calendar';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { Textarea } from '@/components/ui/textarea';
import AppLayout from '@/layouts/AppLayout.vue';
import { cn } from '@/lib/utils';
import { type BreadcrumbItem } from '@/types';
import { Head, useForm } from '@inertiajs/vue3';
import { DateFormatter } from '@internationalized/date';
import { CalendarIcon } from 'lucide-vue-next';

const breadcrumbs: BreadcrumbItem[] = [
    {
        title: 'Exploitation',
        href: '#',
    },
    {
        title: 'Fosts',
        href: route('exploitation.fosts.index'),
    },
    {
        title: 'Modifier une fost',
        href: route('exploitation.fosts.index'),
    },
];

const props = defineProps<{ fost: any }>();
const fost = props.fost;

const form = useForm({
    code: fost.code || '',
    libelle: fost.libelle || '',
    denomination: fost.denomination || '',
    dateDebut: new Date(fost.date_debut) || undefined,
    dateFin: fost.date_fin ? new Date(fost.date_fin) : '',
});

const df = new DateFormatter('fr-FR', {
    dateStyle: 'long',
});
const submitForm = () => {
    form.transform((data) => ({
        code: data.code,
        libelle: data.libelle,
        denomination: data.denomination,
        dateDebut: data.dateDebut ? new Date(data.dateDebut) : null,
        dateFin: data.dateFin ? new Date(data.dateFin) : null,
    })).put(route('exploitation.fosts.update', fost.id), {
        preserveScroll: true,
    });
};
</script>

<template>
    <Head title="Modification Fost" />

    <AppLayout :breadcrumbs="breadcrumbs">
        <div class="flex h-full flex-1 flex-col gap-4 rounded-xl p-4">
            <div>
                <LinkBtnRetour :href="route('exploitation.fosts.index')" />
            </div>
            <form class="flex flex-col gap-6" @submit.prevent="submitForm">
                <div class="grid gap-2">
                    <Label for="code">code :</Label>
                    <Input
                        id="code"
                        name="code"
                        type="text"
                        :tabindex="1"
                        autocomplete="none"
                        v-model="form.code"
                        placeholder="Saisir le code de la fost"
                        class="w-1/2"
                    />
                    <InputError class="mt-2" :message="form.errors.code" />
                </div>
                <div class="grid gap-2">
                    <Label for="libelle">Libelle :</Label>
                    <Input
                        id="libelle"
                        name="libelle"
                        type="text"
                        :tabindex="2"
                        autocomplete="none"
                        v-model="form.libelle"
                        placeholder="Saisir le libellé de la fost"
                        class="w-1/2"
                    />
                    <InputError class="mt-2" :message="form.errors.libelle" />
                </div>
                <div class="grid gap-2">
                    <Label for="denomination">Dénomination :</Label>
                    <Textarea
                        id="denomination"
                        name="denomination"
                        type="text"
                        :tabindex="3"
                        autocomplete="none"
                        v-model="form.denomination"
                        placeholder="Saisir la dénomination de la fost"
                        class="min-h-32 w-1/2 break-normal"
                    />
                    <InputError class="mt-2" :message="form.errors.denomination" />
                </div>
                <div class="grid gap-2">
                    <div class="flex gap-2">
                        <Label for="dateDebut">Date de Début :</Label>
                        <div class="flex flex-col">
                            <Popover>
                                <PopoverTrigger as-child>
                                    <Button
                                        variant="outline"
                                        :class="cn('w-[280px] justify-start text-left font-normal', !form.dateDebut && 'text-muted-foreground')"
                                    >
                                        <CalendarIcon class="mr-2 h-4 w-4" />
                                        {{ form.dateDebut ? df.format(new Date(form.dateDebut)) : 'Coucou' }}
                                    </Button>
                                </PopoverTrigger>
                                <PopoverContent class="w-auto p-0">
                                    <Calendar v-model="form.dateDebut" initial-focus />
                                </PopoverContent>
                            </Popover>
                        </div>

                        <Label for="dateFin" class="ml-2">Date de Fin :</Label>
                        <div class="flex flex-col">
                            <Popover>
                                <PopoverTrigger as-child>
                                    <Button
                                        variant="outline"
                                        :class="cn('w-[280px] justify-start text-left font-normal', !form.dateFin && 'text-muted-foreground')"
                                    >
                                        <CalendarIcon class="mr-2 h-4 w-4" />
                                        {{ form.dateFin ? df.format(new Date(form.dateFin)) : 'Coucou' }}
                                    </Button>
                                </PopoverTrigger>
                                <PopoverContent class="w-auto p-0">
                                    <Calendar v-model="form.dateFin" initial-focus />
                                </PopoverContent>
                            </Popover>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <BtnModifier type="submit" />
                </div>
            </form>
        </div>
    </AppLayout>
</template>
