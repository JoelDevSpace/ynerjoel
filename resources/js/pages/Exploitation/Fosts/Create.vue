<script setup lang="ts">
import BtnAjouter from '@/components/buttons/BtnAjouter.vue';
import InputError from '@/components/InputError.vue';
import LinkBtnRetour from '@/components/links/LinkBtnRetour.vue';
import { Button } from '@/components/ui/button';
import { Calendar } from '@/components/ui/calendar';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Popover, PopoverContent, PopoverTrigger } from '@/components/ui/popover';
import { Textarea } from '@/components/ui/textarea';
import AppLayout from '@/layouts/AppLayout.vue';
import { cn } from '@/lib/utils';
import { type BreadcrumbItem } from '@/types';
import { Head, useForm } from '@inertiajs/vue3';
import { DateFormatter } from '@internationalized/date';
import { CalendarIcon } from 'lucide-vue-next';

const breadcrumbs: BreadcrumbItem[] = [
    {
        title: 'Exploitation',
        href: '#',
    },
    {
        title: 'Fosts',
        href: route('exploitation.fosts.index'),
    },
    {
        title: 'Ajouter une fost',
        href: route('exploitation.fosts.create'),
    },
];

defineProps<{
    SecteursFost: any;
    TypesFost: any;
}>();

const form = useForm({
    SecteursFost: '',
    TypesFost: '',
    numero: '',
    libelle: '',
    denomination: '',
    dateDebut: null as Date | null,
    dateFin: null as Date | null,
});

const df = new DateFormatter('fr-FR', {
    dateStyle: 'long',
});

const submitForm = () => {
    form.transform((data) => ({
        SecteursFost: data.SecteursFost,
        TypesFost: data.TypesFost,
        numero: data.numero,
        libelle: data.libelle,
        denomination: data.denomination,
        dateDebut: data.dateDebut ? new Date(data.dateDebut) : null,
        dateFin: data.dateFin ? new Date(data.dateFin) : null,
    })).post(route('exploitation.fosts.store'), {
        preserveScroll: true,
    });
};
</script>

<template>
    <Head title="Ajout Fost" />

    <AppLayout :breadcrumbs="breadcrumbs">
        <div class="flex h-full flex-1 flex-col gap-4 rounded-xl p-4">
            <div>
                <LinkBtnRetour :href="route('exploitation.fosts.index')" />
            </div>
            <form class="flex flex-col gap-6" @submit.prevent="submitForm">
                <div class="grid gap-2">
                    <div class="flex">
                        <div class="flex flex-col gap-2">
                            <Label for="secteur">Secteur :</Label>
                            <select
                                id="secteur"
                                v-model="form.SecteursFost"
                                class="mt-2 block rounded-md border border-gray-300 px-3 py-2 text-base text-gray-400 shadow-sm transition focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                :tabindex="1"
                            >
                                <option value="">Sélectionner un secteur</option>
                                <option v-for="secteur in SecteursFost" :key="secteur" :value="secteur.value" class="text-gray-800">
                                    {{ secteur.name }} / {{ secteur.value }}
                                </option>
                            </select>
                            <InputError class="mt-2" :message="form.errors.SecteursFost" />
                        </div>
                        <div class="mx-2 flex flex-col gap-2">
                            <Label for="type">Type :</Label>
                            <select
                                id="type"
                                v-model="form.TypesFost"
                                class="mt-2 block rounded-md border border-gray-300 px-3 py-2 text-base text-gray-400 shadow-sm transition focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                                :tabindex="2"
                            >
                                <option value="">Sélectionner un élément</option>
                                <option v-for="type in TypesFost" :key="type" :value="type.value" class="text-gray-800">
                                    {{ type.name }} / {{ type.value }}
                                </option>
                            </select>
                            <InputError class="mt-2" :message="form.errors.TypesFost" />
                        </div>
                        <div class="flex flex-col gap-2">
                            <Label for="numero">Numéro :</Label>
                            <Input
                                id="numero"
                                name="numero"
                                type="text"
                                autofocus
                                :tabindex="3"
                                autocomplete="none"
                                v-model="form.numero"
                                placeholder="Saisir le num de la fost"
                                class="mt-2 block rounded-md border border-gray-300 px-4 py-2 text-base text-gray-400 shadow-sm transition focus:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:outline-none"
                            />
                            <InputError class="mt-2" :message="form.errors.numero" />
                        </div>
                    </div>
                </div>
                <div class="grid gap-2">
                    <Label for="libelle">Libelle :</Label>
                    <Input
                        id="libelle"
                        name="libelle"
                        type="text"
                        :tabindex="4"
                        autocomplete="none"
                        v-model="form.libelle"
                        placeholder="Saisir le libellé de la fost"
                        class="w-1/2"
                    />
                    <InputError class="mt-2" :message="form.errors.libelle" />
                </div>
                <div class="grid gap-2">
                    <Label for="denomination">Dénomination :</Label>
                    <Textarea
                        id="denomination"
                        name="denomination"
                        type="text"
                        :tabindex="5"
                        autocomplete="none"
                        v-model="form.denomination"
                        placeholder="Saisir la dénomination de la fost"
                        class="min-h-32 w-1/2 break-normal"
                    />
                    <InputError class="mt-2" :message="form.errors.denomination" />
                </div>
                <div class="grid gap-2">
                    <div class="flex gap-2">
                        <Label for="dateDebut">Date de Début :</Label>
                        <div class="flex flex-col">
                            <Popover>
                                <PopoverTrigger as-child>
                                    <Button
                                        variant="outline"
                                        :class="cn('w-[280px] justify-start text-left font-normal', !form.dateDebut && 'text-muted-foreground')"
                                    >
                                        <CalendarIcon class="mr-2 h-4 w-4" />
                                        {{ form.dateDebut ? df.format(new Date(form.dateDebut)) : 'date début' }}
                                    </Button>
                                </PopoverTrigger>
                                <PopoverContent class="w-auto p-0">
                                    <Calendar v-model="form.dateDebut" initial-focus />
                                </PopoverContent>
                            </Popover>
                            <InputError class="mt-2" :message="form.errors.dateDebut" />
                        </div>

                        <Label for="dateFin" class="ml-2">Date de Fin :</Label>
                        <div class="flex flex-col">
                            <Popover>
                                <PopoverTrigger as-child>
                                    <Button
                                        variant="outline"
                                        :class="cn('w-[280px] justify-start text-left font-normal', !form.dateFin && 'text-muted-foreground')"
                                    >
                                        <CalendarIcon class="mr-2 h-4 w-4" />
                                        {{ form.dateFin ? df.format(new Date(form.dateFin)) : 'date fin' }}
                                    </Button>
                                </PopoverTrigger>
                                <PopoverContent class="w-auto p-0">
                                    <Calendar v-model="form.dateFin" initial-focus />
                                </PopoverContent>
                            </Popover>
                            <InputError class="mt-2" :message="form.errors.dateFin" />
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-4"><BtnAjouter type="submit" /></div>
            </form>
        </div>
    </AppLayout>
</template>
